<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Home</title>
  <style>
    :root{
      --bg:#0b0f17;
      --card:#111827;
      --border:#1f2937;
      --muted:rgba(230,237,243,.65);
      --text:#e6edf3;
      --link:#7dd3fc;
      --chip:#0b1220;
      --chipBorder:#334155;
      --shadow: 0 10px 24px rgba(0,0,0,.28);
      --radius:16px;
    }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial; margin:0; background:var(--bg); color:var(--text)}
    .wrap{max-width:1280px; margin:0 auto; padding:18px}
    .topbar{display:flex; gap:12px; align-items:center; margin-bottom:14px; flex-wrap:wrap}
    .brand{font-weight:700; letter-spacing:.2px}
    .muted{opacity:.7; font-size:12px}
    .grid{display:grid; grid-template-columns: 1.15fr 1.7fr 1.15fr; gap:14px}
    .card{background:var(--card); border:1px solid var(--border); border-radius:var(--radius); padding:14px; box-shadow: var(--shadow)}
    h2{margin:0 0 10px; font-size:16px}
    h3{margin:12px 0 8px; font-size:13px; color:var(--muted)}
    a{color:var(--link); text-decoration:none}
    a:hover{text-decoration:underline}
    ul{margin:0; padding-left:18px}
    input{width:100%; box-sizing:border-box; border-radius:14px; padding:12px 12px; border:1px solid var(--chipBorder); background:var(--chip); color:var(--text)}
    .btns{display:flex; gap:10px; margin-top:10px; flex-wrap:wrap}
    button{border-radius:14px; padding:10px 12px; border:1px solid var(--chipBorder); background:var(--chip); color:var(--text); cursor:pointer}
    button:hover{background:#0f1a30}
    .row{display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap}
    .badge{display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border-radius:999px; border:1px solid var(--chipBorder); background:rgba(11,18,32,.7); font-size:12px; color:var(--muted)}
    .dot{width:8px; height:8px; border-radius:999px; background:#ef4444; box-shadow:0 0 0 4px rgba(239,68,68,.18)}
    .list{display:flex; flex-direction:column; gap:10px}
    .item{display:flex; gap:10px; padding:10px; border:1px solid var(--border); border-radius:14px; background:rgba(17,24,39,.55)}
    .thumb{width:96px; height:54px; border-radius:10px; border:1px solid var(--border); object-fit:cover; flex:0 0 auto}
    .meta{min-width:0}
    .title{font-size:13px; line-height:1.25; margin:0 0 6px; font-weight:600; word-break:break-word}
    .sub{font-size:12px; color:var(--muted); display:flex; gap:10px; flex-wrap:wrap}
    .pill{display:inline-flex; align-items:center; gap:6px; padding:2px 8px; border-radius:999px; border:1px solid var(--chipBorder); background:rgba(11,18,32,.7)}
    .rightcol ul{padding-left:16px}
    .small{font-size:12px; color:var(--muted)}
    @media (max-width: 1040px){ .grid{grid-template-columns:1fr} }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar">
      <div class="brand">ğŸ  Ryan's Dashboard</div>
      <div class="badge" id="statusBadge">â³ æ­£åœ¨åŠ è½½æ•°æ®â€¦</div>
      <div class="muted" id="updatedAt"></div>
    </div>

    <div class="grid">
      <!-- å·¦åˆ— -->
      <div class="card">
        <h2>ğŸ” æœç´¢</h2>
        <input id="q" placeholder="è¾“å…¥å…³é”®è¯ï¼Œå›è½¦æœç´¢â€¦" />
        <div class="btns">
          <button onclick="go('google')">Google</button>
          <button onclick="go('bili')">Bç«™</button>
          <button onclick="go('yt')">YouTube</button>
        </div>

        <h3>â­ å¸¸ç”¨é“¾æ¥ï¼ˆç¤ºä¾‹ï¼‰</h3>
        <ul>
          <li><a href="https://www.youtube.com/" target="_blank">YouTube</a></li>
          <li><a href="https://www.bilibili.com/" target="_blank">å“”å“©å“”å“©</a></li>
          <li><a href="https://github.com/" target="_blank">GitHub</a></li>
        </ul>

        <p class="small">åç»­æˆ‘å¯ä»¥å¸®ä½ åšï¼šåˆ†ç»„ä¹¦ç­¾ + æœ¬åœ°å¯ç¼–è¾‘ + æ‹–æ‹½æ’åº ğŸ˜</p>
      </div>

      <!-- ä¸­åˆ—ï¼šå¼€æ’­ç›‘æ§ -->
      <div class="card" id="liveCard">
        <h2>ğŸ“º å¼€æ’­ç›‘æ§</h2>
        <div class="muted">æ­£åœ¨åŠ è½½â€¦</div>
      </div>

      <!-- å³åˆ—ï¼šé¢„ç•™æ¨¡å— -->
      <div class="card rightcol">
        <h2>ğŸ§© æ¨¡å—</h2>
        <ul>
          <li>ğŸ“° çƒ­æ¦œï¼ˆBç«™/å¾®åš/HNï¼‰</li>
          <li>âœ… å¾…åŠï¼ˆæœ¬åœ°å­˜å‚¨/äº‘ç«¯åŒæ­¥ï¼‰</li>
          <li>ğŸŒ¦ï¸ å¤©æ°”ï¼ˆå¯é€‰ï¼‰</li>
          <li>ğŸ’» Homelab çŠ¶æ€ï¼ˆæ¢æ´»/é¢æ¿ï¼‰</li>
        </ul>
        <p class="small">ä½ æƒ³ä¸‹ä¸€æ­¥å…ˆåŠ å“ªä¸ªï¼Ÿæˆ‘æŒ‰ä½ ä¹ æƒ¯å¾€â€œä¿¡æ¯å¯†é›†â€æ–¹å‘å †èµ·æ¥ã€‚</p>
      </div>
    </div>
  </div>

<script>
function go(engine){
  const q = document.getElementById('q').value.trim();
  if(!q) return;
  const m = {
    google: `https://www.google.com/search?q=${encodeURIComponent(q)}`,
    bili: `https://search.bilibili.com/all?keyword=${encodeURIComponent(q)}`,
    yt: `https://www.youtube.com/results?search_query=${encodeURIComponent(q)}`
  };
  window.open(m[engine], '_blank');
}
document.getElementById('q').addEventListener('keydown', (e)=>{
  if(e.key === 'Enter') go('google');
});

function fmtTime(iso){
  try{
    const d = new Date(iso);
    return d.toLocaleString();
  }catch{ return iso; }
}

function renderItems(items, fallbackText){
  if(!items || items.length === 0) return `<div class="muted">${fallbackText}</div>`;
  return `<div class="list">${
    items.map(x => {
      const thumb = x.thumb || x.cover || "";
      const title = x.title || "ï¼ˆæ— æ ‡é¢˜ï¼‰";
      const url = x.url || "#";
      const line1 = x.platform === "bilibili"
        ? `${x.uname || "Bç«™ä¸»æ’­"}`
        : `${x.channelTitle || "YouTube"}`;
      const tag = x.platform === "bilibili"
        ? (x.live_status === 1 ? "LIVE" : "OFF")
        : (x.eventType === "live" ? "LIVE" : "UPCOMING");

      const tagDot = (tag === "LIVE") ? `<span class="dot"></span>` : "";

      return `
        <div class="item">
          ${thumb ? `<img class="thumb" src="${thumb}" alt="">` : `<div class="thumb"></div>`}
          <div class="meta">
            <div class="row">
              <div class="pill">${tagDot}<span>${tag}</span></div>
              <div class="small">${x.publishedAt ? fmtTime(x.publishedAt) : ""}</div>
            </div>
            <div class="title"><a href="${url}" target="_blank">${title}</a></div>
            <div class="sub">
              <span>${line1}</span>
              <span class="pill">${x.platform}</span>
            </div>
          </div>
        </div>
      `;
    }).join("")
  }</div>`;
}

async function refreshLive(){
  const badge = document.getElementById("statusBadge");
  const updatedAt = document.getElementById("updatedAt");
  const box = document.getElementById("liveCard");

  try{
    badge.textContent = "â³ æ‹‰å–ä¸­â€¦";
    const r = await fetch(`/api/live?ts=${Date.now()}`, { cache: "no-store" });
    const data = await r.json();

    updatedAt.textContent = `æ›´æ–°ï¼š${fmtTime(data.updated_at)} Â· ${data.version || ""}`;
    badge.textContent = "âœ… åœ¨çº¿";

    const liveBili = (data.bili || []).filter(x => x.live_status === 1);
    const liveYT   = (data.youtube || []).filter(x => x.eventType === "live");
    const upYT     = (data.youtube || []).filter(x => x.eventType === "upcoming");
    const chatYT   = (data.youtube_chatroom || []);

    box.innerHTML = `
      <h2>ğŸ“º å¼€æ’­ç›‘æ§</h2>

      <h3>ğŸ”´ æ­£åœ¨ç›´æ’­ï¼ˆBç«™ï¼‰</h3>
      ${renderItems(liveBili, "æš‚æ— ")}

      <h3>ğŸ”´ æ­£åœ¨ç›´æ’­ï¼ˆYouTubeï¼‰</h3>
      ${renderItems(liveYT, "æš‚æ— ")}

      <h3>â³ ç›´æ’­é¢„å‘Šï¼ˆYouTubeï¼‰</h3>
      ${renderItems(upYT, "æš‚æ— ")}

      <h3>ğŸ’¬ å¸¸é©»èŠå¤©å®¤ï¼ˆYouTubeï¼‰</h3>
      ${renderItems(chatYT, "æš‚æ— ")}
    `;
  }catch(e){
    badge.textContent = "âŒ å¼‚å¸¸";
    box.innerHTML = `
      <h2>ğŸ“º å¼€æ’­ç›‘æ§</h2>
      <div class="muted">åŠ è½½å¤±è´¥ï¼š${String(e)}</div>
      <div class="muted">ä½ å¯ä»¥æ‰“å¼€ <a href="/api/live?ts=${Date.now()}" target="_blank">/api/live</a> çœ‹è¯¦ç»†æŠ¥é”™ã€‚</div>
    `;
  }
}

refreshLive();
setInterval(refreshLive, 60_000);
</script>
</body>
</html>
